<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å¨„åº•å…¨åŸŸ Â· æ™ºæ¸¸ä¸æº¯æº</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <style>
        /* ================= 1. è§†è§‰è®¾è®¡ç³»ç»Ÿ ================= */
        :root {
            --primary: #2563eb;
            --accent: #f59e0b;
            --sidebar-w: 420px;
            --glass: rgba(255, 255, 255, 0.98);
        }
        
        body { margin: 0; padding: 0; font-family: -apple-system, "PingFang SC", "Microsoft YaHei", sans-serif; display: flex; height: 100vh; overflow: hidden; background: #f1f5f9; }
        
        /* ä¾§è¾¹æ  */
        .sidebar {
            width: var(--sidebar-w); background: #fff; z-index: 500; display: flex; flex-direction: column;
            box-shadow: 4px 0 25px rgba(0,0,0,0.05); border-right: 1px solid #e2e8f0;
        }

        /* é¡¶éƒ¨ */
        .header { padding: 20px 24px; border-bottom: 1px solid #f1f5f9; background: #fff; }
        .title { font-size: 22px; font-weight: 900; color: #0f172a; margin: 0 0 5px 0; letter-spacing: -0.5px; }
        .subtitle { font-size: 13px; color: #64748b; margin-bottom: 15px; font-weight: 500; letter-spacing: 1px; }

        /* æ¨¡å¼åˆ‡æ¢ */
        .tabs { display: flex; background: #f8fafc; padding: 4px; border-radius: 10px; border: 1px solid #e2e8f0; }
        .tab { 
            flex: 1; text-align: center; padding: 10px; font-size: 14px; font-weight: 600; color: #64748b; 
            cursor: pointer; border-radius: 8px; transition: all 0.2s; 
        }
        .tab.active { background: #fff; color: var(--primary); box-shadow: 0 2px 8px rgba(0,0,0,0.05); }

        /* å†…å®¹åŒº */
        .content { flex: 1; overflow-y: auto; padding: 20px; background: #f8fafc; }
        .panel { display: none; animation: fadeIn 0.3s; }
        .panel.active { display: block; }

        /* åˆ—è¡¨å¡ç‰‡ */
        .spot-card {
            background: #fff; border-radius: 16px; padding: 16px; margin-bottom: 16px;
            border: 1px solid #f1f5f9; cursor: pointer; transition: all 0.2s;
            position: relative; overflow: hidden; display: flex; align-items: flex-start;
        }
        .spot-card:hover { transform: translateY(-2px); box-shadow: 0 10px 25px -5px rgba(0,0,0,0.1); border-color: var(--primary); }
        .spot-card.active { border: 2px solid var(--primary); background: #eff6ff; }
        
        /* å·¦ä¾§è‰²æ¡ */
        .spot-card::before { content: ''; position: absolute; left: 0; top: 0; bottom: 0; width: 6px; }
        .spot-card[data-area="æ–°åŒ–"]::before { background: #8b5cf6; }
        .spot-card[data-area="åŒå³°"]::before { background: #3b82f6; }
        .spot-card[data-area="å†·æ°´æ±Ÿ"]::before { background: #f97316; }
        .spot-card[data-area="æ¶Ÿæº"]::before { background: #10b981; }
        .spot-card[data-area="å¨„æ˜Ÿ"]::before { background: #ef4444; }

        .card-icon { 
            width: 48px; height: 48px; background: #f1f5f9; border-radius: 12px; 
            display: flex; align-items: center; justify-content: center; font-size: 24px; margin-right: 16px; flex-shrink: 0; 
        }
        .card-info { flex: 1; }
        .card-title { font-size: 16px; font-weight: 800; color: #1e293b; margin-bottom: 4px; display: flex; justify-content: space-between; }
        .card-area { font-size: 11px; padding: 2px 6px; background: #f0f0f0; border-radius: 4px; font-weight: normal; color: #888; }
        .card-desc { font-size: 13px; color: #475569; line-height: 1.5; }

        /* ç­›é€‰å™¨ */
        .filter-row { display: flex; gap: 8px; overflow-x: auto; padding-bottom: 10px; margin-bottom: 10px; }
        .tag-btn { white-space: nowrap; padding: 5px 12px; border-radius: 20px; font-size: 12px; background: #fff; border: 1px solid #e0e0e0; color: #666; cursor: pointer; }
        .tag-btn.active { border-color: var(--primary); color: var(--primary); background: #e6f7ff; font-weight: bold; }

        /* å†å²é¢æ¿ */
        .hist-card { background: #fff7ed; border: 1px solid #ffedd5; border-radius: 16px; padding: 24px; }
        .hist-h { font-family: "Kaiti", serif; font-size: 26px; font-weight: 900; color: #7c2d12; margin-bottom: 5px; }
        .hist-sub { color: #c2410c; font-weight: bold; margin-bottom: 20px; }
        .hist-p { font-size: 15px; line-height: 1.8; color: #431407; text-align: justify; }

        /* åœ°å›¾ */
        .map-container { flex: 1; position: relative; }
        #map { width: 100%; height: 100%; }

        /* åº•éƒ¨æ—¶é—´è½´ */
        .timeline-bar {
            position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%);
            background: rgba(255,255,255,0.9); backdrop-filter: blur(10px);
            padding: 8px; border-radius: 100px; display: none; gap: 8px;
            box-shadow: 0 10px 30px -5px rgba(0,0,0,0.2); z-index: 1000;
            border: 1px solid rgba(255,255,255,0.5);
        }
        .timeline-bar.show { display: flex; }
        .t-btn {
            padding: 8px 20px; border-radius: 50px; font-size: 13px; font-weight: 700; color: #64748b;
            cursor: pointer; transition: all 0.2s; border: 1px solid transparent;
        }
        .t-btn:hover { background: #f1f5f9; }
        .t-btn.active { background: #1e293b; color: #fff; box-shadow: 0 4px 12px rgba(0,0,0,0.15); }

        /* å¼¹çª— */
        .leaflet-popup-content-wrapper { border-radius: 12px; padding: 0; box-shadow: 0 20px 40px -10px rgba(0,0,0,0.3); }
        .leaflet-popup-content { margin: 0; width: 260px !important; }
        .pop-head { padding: 15px; color: #fff; font-weight: 800; font-size: 15px; }
        .pop-body { padding: 15px; font-size: 13px; color: #334155; line-height: 1.6; }
        .pop-link { display: block; margin-top: 10px; background: #10b981; color: #fff; text-align: center; padding: 8px; border-radius: 6px; text-decoration: none; font-weight: bold; }

        @media (max-width: 768px) { body { flex-direction: column-reverse; } .sidebar { width: 100%; height: 50%; } }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

<div class="sidebar">
    <div class="header">
        <div class="title">å¨„åº•å…¨åŸŸå¯¼è§ˆ</div>
        <div class="subtitle">æ¹˜ä¸­æ˜ç  Â· èš©å°¤æ•…é‡Œ Â· æ¹˜å†›æ‘‡ç¯®</div>
        <div class="tabs">
            <div class="tab active" onclick="setMode('tour')">ğŸš€ ç°ä»£æ™¯ç‚¹</div>
            <div class="tab" onclick="setMode('hist')">ğŸ“œ å†å²ç–†åŸŸ</div>
        </div>
    </div>
    
    <div class="content">
        <div id="view-tour" class="panel active">
            <div class="filter-row">
                <div class="tag-btn active" onclick="filterSpots('all', this)">å…¨éƒ¨</div>
                <div class="tag-btn" onclick="filterSpots('é«˜æ ¡', this)">ğŸ“ é«˜æ ¡</div>
                <div class="tag-btn" onclick="filterSpots('å­¦åºœ', this)">ğŸ« ç™¾å¹´å­¦åºœ</div>
                <div class="tag-btn" onclick="filterSpots('æ–°åŒ–', this)">æ–°åŒ–</div>
                <div class="tag-btn" onclick="filterSpots('åŒå³°', this)">åŒå³°</div>
                <div class="tag-btn" onclick="filterSpots('å†·æ°´æ±Ÿ', this)">å†·æ°´æ±Ÿ</div>
                <div class="tag-btn" onclick="filterSpots('æ¶Ÿæº', this)">æ¶Ÿæº</div>
                <div class="tag-btn" onclick="filterSpots('å¨„æ˜Ÿ', this)">å¨„æ˜Ÿ</div>
            </div>
            <div id="spotList"></div>
        </div>
        
        <div id="view-hist" class="panel">
            <div class="hist-card">
                <div class="hist-h" id="h-title"></div>
                <div class="hist-sub" id="h-era"></div>
                <div class="hist-p" id="h-desc"></div>
            </div>
        </div>
    </div>
</div>

<div class="map-container">
    <div id="map"></div>
    <div class="timeline-bar" id="timeline">
        <div class="t-btn" onclick="loadHist(0)">ç§¦æ±‰</div>
        <div class="t-btn" onclick="loadHist(1)">å®‹ä»£</div>
        <div class="t-btn" onclick="loadHist(2)">æ¸…ä»£</div>
        <div class="t-btn" onclick="loadHist(3)">1969</div>
        <div class="t-btn" onclick="loadHist(4)">1977</div>
        <div class="t-btn active" onclick="loadHist(5)">ç°ä»£</div>
    </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
    // 1. åˆå§‹åŒ–åœ°å›¾
    const map = L.map('map', { zoomControl: false }).setView([27.7017, 111.9963], 9);
    L.control.zoom({ position: 'topright' }).addTo(map);
    L.tileLayer('http://webrd02.is.autonavi.com/appmaptile?lang=zh_cn&size=1&scale=1&style=8&x={x}&y={y}&z={z}', {
        subdomains: ["01", "02", "03", "04"], attribution: 'Â© é«˜å¾·åœ°å›¾'
    }).addTo(map);

    // ===========================================
    // 2. æ ¸å¿ƒæ•°æ®
    // ===========================================
    const spots = [
    // --- ğŸ“ å¨„åº•é«˜æ ¡ ---
    { "name": "æ¹–å—äººæ–‡ç§‘æŠ€å­¦é™¢", "lat": 27.7128, "lng": 112.0064, "area": "å¨„æ˜Ÿ", "icon": "ğŸ“", "tags": "é«˜æ ¡", "desc": "å¨„åº•å”¯ä¸€çš„å…¬åŠæœ¬ç§‘é™¢æ ¡ï¼Œå‰èº«æ˜¯å¨„åº•å¸ˆä¸“ã€‚" },
    { "name": "å¨„åº•èŒä¸šæŠ€æœ¯å­¦é™¢", "lat": 27.7413, "lng": 112.0217, "area": "å¨„æ˜Ÿ", "icon": "ğŸ“", "tags": "é«˜æ ¡", "desc": "å›½å®¶éª¨å¹²é«˜èŒé™¢æ ¡ï¼Œä½äºæœˆå¡˜è¡—ã€‚" },
    { "name": "å¨„åº•æ½‡æ¹˜èŒä¸šå­¦é™¢", "lat": 27.7628, "lng": 111.9853, "area": "å¨„æ˜Ÿ", "icon": "ğŸ“", "tags": "é«˜æ ¡", "desc": "ä½äºå¨„åº•ç»å¼€åŒºï¼Œæ°‘åŠé«˜èŒé™¢æ ¡ã€‚" },
    { "name": "å¨„åº•å¹¼å„¿å¸ˆèŒƒä¸“ç§‘å­¦æ ¡", "lat": 27.6858, "lng": 111.4350, "area": "å†·æ°´æ±Ÿ", "icon": "ğŸ“", "tags": "é«˜æ ¡", "desc": "å‰èº«ä¸ºå†·æ°´æ±Ÿå¸ˆèŒƒï¼ŒåŸ¹å…»å¹¼æ•™äººæ‰ã€‚" },

    // --- ğŸ« ç™¾å¹´å­¦åºœ ---
    { "name": "æ–°åŒ–ä¸€ä¸­", "lat": 27.736226, "lng": 111.317986, "area": "æ–°åŒ–", "icon": "ğŸ«", "tags": "å­¦åºœ", "desc": "åˆ›åŠäº1898å¹´ï¼ŒåŸåæ–°åŒ–å®å­¦å ‚ã€‚" },
    { "name": "åŒå³°ä¹¦é™¢ (åŒå³°ä¸€ä¸­)", "lat": 27.460377, "lng": 112.163784, "area": "åŒå³°", "icon": "ğŸ«", "tags": "å­¦åºœ", "desc": "å§‹äº1760å¹´ä¹¾éš†å¾¡æ‰¹çš„åŒå³°ä¹¦é™¢ã€‚" },
    { "name": "æ¶Ÿæºä¸€ä¸­ (å›½å¸ˆæ—§å€)", "lat": 27.6953, "lng": 111.6636, "area": "æ¶Ÿæº", "icon": "ğŸ«", "tags": "å­¦åºœ", "desc": "æŠ—æˆ˜æ—¶æœŸâ€œå›½ç«‹å¸ˆèŒƒå­¦é™¢â€æ—§å€ã€‚" },

    // --- æ ¸å¿ƒæ™¯ç‚¹ ---
    { "name": "ç½—ç››æ•™çºªå¿µé¦†", "lat": 27.733984, "lng": 111.309827, "area": "æ–°åŒ–", "icon": "ğŸ–ï¸", "desc": "ä½äºæ–°åŒ–èµ„æ±Ÿä¸€æ¡¥è¥¿ç«¯åŒ—ä¾§ï¼Œçºªå¿µä¼Ÿå¤§çš„å›½é™…ä¸»ä¹‰æˆ˜å£«ç½—ç››æ•™ã€‚" },
    { "name": "æ–°åŒ–å¤åŸ(å‘ä¸œè¡—)", "lat": 27.746193, "lng": 111.308176, "area": "æ–°åŒ–", "icon": "ğŸ®", "desc": "èµ„æ±Ÿè€ç å¤´æ—çš„åƒå¹´å¤è¡—ï¼Œä¿ç•™äº†å¤§é‡æ˜æ¸…å»ºç­‘ï¼Œæ˜¯ç¾é£Ÿèšé›†åœ°ã€‚" },
    { "name": "åŒ—å¡”å…¬å›­", "lat": 27.755897, "lng": 111.306781, "area": "æ–°åŒ–", "icon": "ğŸ—¼", "desc": "çŸ—ç«‹äºèµ„æ±ŸåŒ—å²¸ï¼Œå¤å¡”å‡Œéœ„ï¼Œæ˜¯æ–°åŒ–å¿åŸçš„æ ‡å¿—æ€§æ™¯è§‚ã€‚" },
    { "name": "ç‹®å­å±±å…¬å›­", "lat": 27.7325, "lng": 111.3435, "area": "æ–°åŒ–", "icon": "ğŸ¦", "desc": "ä½äºå¿åŸä¸œéƒ¨ï¼Œå› å±±å½¢ä¼¼å§ç‹®è€Œå¾—åï¼Œæ˜¯å¸‚æ°‘ä¼‘é—²å¥èº«çš„å¤©ç„¶æ°§å§ã€‚" },
    { "name": "ç´«é¹Šç•Œæ¢¯ç”°", "lat": 27.691577, "lng": 110.968766, "area": "æ–°åŒ–", "icon": "ğŸŒ¾", "desc": "å…¨çƒé‡è¦å†œä¸šæ–‡åŒ–é—äº§ï¼Œä¸¤åƒå¤šå¹´å†å²çš„ç§¦æ±‰å¤æ¢¯ç”°ï¼ŒçŒæº‰å¥‡è§‚ã€‚" },
    { "name": "å¤§ç†Šå±±å…¬å›­", "lat": 28.1309, "lng": 111.31559, "area": "æ–°åŒ–", "icon": "ğŸŒ²", "desc": "æ¹˜ä¸­å±‹è„Šï¼Œèš©å°¤ç¥–å±±ï¼Œæ‹¥æœ‰å¹¿è¢¤çš„åŸå§‹æ¬¡ç”Ÿæ—ã€‚" },
    { "name": "æ¢…å±±é¾™å®«", "lat": 27.94995, "lng": 111.29326, "area": "æ–°åŒ–", "icon": "ğŸ²", "desc": "äºšæ´²æœ€ç¾æº¶æ´ä¹‹ä¸€ï¼Œèµ„æ±Ÿç•”çš„åœ°ä¸‹è‰ºæœ¯å®«æ®¿ã€‚" },
    { "name": "æ›¾å›½è—©æ•…å±…", "lat": 27.407134, "lng": 112.459149, "area": "åŒå³°", "icon": "ğŸ“œ", "desc": "è·å¶é•‡å¯Œåšå ‚ï¼Œä¸­å›½ä¿å­˜æœ€å®Œå¥½çš„ä¹¡é—´ä¾¯åºœï¼Œå®¶æ•™æ–‡åŒ–å…¸èŒƒã€‚" },
    { "name": "è”¡å’Œæ£®çºªå¿µé¦†", "lat": 27.456683, "lng": 112.202359, "area": "åŒå³°", "icon": "ğŸš©", "desc": "ä½äºåŒå³°å¿åŸä¸­å¿ƒï¼Œçºªå¿µä¸­å›½å…±äº§å…šæ—©æœŸé¢†å¯¼äººè”¡å’Œæ£®ã€‚" },
    { "name": "æ°´åºœåº™æ°´åº“", "lat": 27.706592, "lng": 112.176226, "area": "åŒå³°", "icon": "ğŸŒŠ", "desc": "æ¹˜ä¸­ç¬¬ä¸€å¤§äººå·¥æ¹–ï¼ŒçƒŸæ³¢æµ©æ¸ºï¼Œæ™¯è‰²å®œäººã€‚" },
    { "name": "æ³¢æœˆæ´", "lat": 27.70362, "lng": 111.45722, "area": "å†·æ°´æ±Ÿ", "icon": "ğŸ’", "desc": "86ç‰ˆã€Šè¥¿æ¸¸è®°ã€‹æ°´å¸˜æ´å–æ™¯åœ°ï¼Œä¸–ç•Œç†”å²©åšç‰©é¦†ã€‚" },
    { "name": "é”¡çŸ¿å±±é—å€", "lat": 27.754645, "lng": 111.491446, "area": "å†·æ°´æ±Ÿ", "icon": "âš’ï¸", "desc": "ä¸–ç•Œé”‘éƒ½ï¼Œä¿ç•™äº†ç‹¬ç‰¹çš„å·¥çŸ¿ä¸šé—è¿¹å’Œçº¢è‰²è®°å¿†ã€‚" },
    { "name": "æ¹„æ±Ÿåœ°è´¨å…¬å›­", "lat": 27.898575, "lng": 111.74539, "area": "æ¶Ÿæº", "icon": "ğŸï¸", "desc": "ä¸‰æ¹˜ç‹¬ç§€ï¼Œåé‡Œç”»å»Šï¼Œå…¸å‹çš„å–€æ–¯ç‰¹åœ°è²Œå¥‡è§‚ã€‚" },
    { "name": "é¾™å±±è¯ç‹è°·", "lat": 27.5233, "lng": 111.827, "area": "æ¶Ÿæº", "icon": "ğŸ’Š", "desc": "ç›¸ä¼ è¯ç‹å­™æ€é‚ˆæ›¾åœ¨æ­¤éšå±…ï¼Œé«˜å±±é¿æš‘å…»ç”Ÿèƒœåœ°ã€‚" },
    { "name": "çŸ³é©¬å…¬å›­", "lat": 27.735995, "lng": 112.012616, "area": "å¨„æ˜Ÿ", "icon": "ğŸ", "desc": "å¨„åº•å¸‚ä¸­å¿ƒçš„è€ç‰Œå…¬å›­ï¼Œå› å›­å†…æœ‰çŸ³é©¬é›•åƒè€Œå¾—åã€‚" },
    { "name": "å­™æ°´å…¬å›­", "lat": 27.694098, "lng": 111.994537, "area": "å¨„æ˜Ÿ", "icon": "ğŸŒ³", "desc": "å¸‚æ”¿åºœæ—çš„å¤§å‹åŸå¸‚å…¬å›­ï¼Œè¢«èª‰ä¸ºåŸå¸‚ç»¿è‚ºã€‚" },
    { "name": "ä¸‰è”å³’å†°æ³‰", "lat": 27.6180, "lng": 111.1650, "area": "æ–°åŒ–", "icon": "ğŸ§Š", "desc": "ç»´å±±ä¹¡ï¼Œå–Šæ³‰ä¸ç»ç’ƒæ¡¥ã€‚" },
    { "name": "æ¸ æ±ŸæºèŒ¶å›­", "lat": 27.7328, "lng": 110.8947, "area": "æ–°åŒ–", "icon": "ğŸµ", "desc": "å¥‰å®¶é•‡ï¼Œé»‘èŒ¶ä¹‹æºã€‚" },
    { "name": "æ²¹æºªæ²³æ¼‚æµ", "lat": 27.9618, "lng": 111.2999, "area": "æ–°åŒ–", "icon": "ğŸš£", "desc": "ä¸­åç¬¬ä¸€æ¼‚ï¼Œå³¡è°·æ€¥æµã€‚" },
    { "name": "å³¡çŸ³å¤æ‘", "lat": 27.3833, "lng": 112.3740, "area": "åŒå³°", "icon": "ğŸ¡", "desc": "æ˜æ¸…å¤å»ºç­‘ç¾¤ã€‚" },
    { "name": "ä¹å³°å±±å…¬å›­", "lat": 27.3702, "lng": 112.3358, "area": "åŒå³°", "icon": "â›°ï¸", "desc": "åŒå³°è¡¡é˜³äº¤ç•Œï¼Œç™»å±±è¿œçœºã€‚" },
    { "name": "å¤§ä¹˜å±±", "lat": 27.5942, "lng": 111.4255, "area": "å†·æ°´æ±Ÿ", "icon": "ğŸŒ„", "desc": "å†·æ±ŸåŒ—éƒŠä½›æ•™åœ£åœ°ã€‚" },
    { "name": "èµ„æ±Ÿé£å…‰å¸¦", "lat": 27.6794, "lng": 111.4358, "area": "å†·æ°´æ±Ÿ", "icon": "ğŸŒ‰", "desc": "å¸‚åŒºæ²¿æ±Ÿé£å…‰å¸¦ã€‚" },
    { "name": "è°¢å†°è¹æ•…å±…", "lat": 27.6604, "lng": 111.5941, "area": "å†·æ°´æ±Ÿ", "icon": "âœï¸", "desc": "å¥³ä½œå®¶è°¢å†°è¹æ•…å±…ï¼Œé“å±±é•‡ã€‚" },
    { "name": "é£æ°´æ¶¯ç€‘å¸ƒ", "lat": 27.5196, "lng": 111.8141, "area": "æ¶Ÿæº", "icon": "ğŸ’§", "desc": "æ¹˜ä¸­ç¬¬ä¸€ç€‘ï¼Œæ°”åŠ¿ç£…ç¤´ã€‚" },
    { "name": "ç™½é©¬æ¹–", "lat": 27.75, "lng": 111.6, "area": "æ¶Ÿæº", "icon": "â›µ", "desc": "æ°´åŸŸå®½é˜”ï¼Œä¼‘é—²å‚é’“ã€‚" },
    { "name": "å›´åŸæ•…é‡Œ", "lat": 27.7080, "lng": 111.6718, "area": "æ¶Ÿæº", "icon": "ğŸ°", "desc": "é’±é’Ÿä¹¦ã€Šå›´åŸã€‹èƒŒæ™¯åœ°è“ç”°ã€‚" },
    { "name": "ä»™å¥³å¯¨", "lat": 27.8451, "lng": 111.8161, "area": "å¨„æ˜Ÿ", "icon": "ğŸ§š", "desc": "ä¸‡å®é•‡ï¼Œç™»å±±ç¥ˆç¦ã€‚" },
    { "name": "å¨„åº•åšç‰©é¦†", "lat": 27.7448, "lng": 112.0353, "area": "å¨„æ˜Ÿ", "icon": "ğŸ›ï¸", "desc": "å†å²æ–‡åŒ–çª—å£ã€‚" },
    { "name": "åŒæ±Ÿæ°´åº“", "lat": 27.8886, "lng": 111.9639, "area": "å¨„æ˜Ÿ", "icon": "ğŸ£", "desc": "åŒ—éƒŠæ°´æºåœ°ï¼Œéœ²è¥å¥½å»å¤„ã€‚" },
    { "name": "é’å±±å…¬å›­", "lat": 27.7522, "lng": 111.9875, "area": "å¨„æ˜Ÿ", "icon": "ğŸŒ³", "desc": "åŸå¸‚ç¤¾åŒºå…¬å›­ã€‚" }
];

    // ===========================================
    // 3. å†å²æ—¶æœŸé…ç½® (âœ… å†å²æ•°æ®å·²è¡¥å…¨)
    // ===========================================
    const historyEras = [
        {
            year: "ç§¦æ±‰-å”",
            title: "æ¢…å±±è›®åœ° & æ¹˜å—å¿",
            desc: "ç§¦æ±‰æ—¶æœŸï¼Œä»Šå¨„åº•ä¸œéƒ¨ï¼ˆåŒå³°ã€æ¶Ÿæºç­‰åœ°ï¼‰å±é•¿æ²™éƒ¡<b>æ¹˜å—å¿</b>ã€‚è€Œè¥¿éƒ¨ï¼ˆæ–°åŒ–ã€å†·æ°´æ±Ÿï¼‰åˆ™æ˜¯<b>æ¢…å±±è›®</b>çš„æ´»åŠ¨åœ°åŸŸï¼Œé•¿æœŸå¤„äºåŠç‹¬ç«‹çŠ¶æ€ã€‚<br>ğŸ—ºï¸ <b>åœ°å›¾ï¼š</b>è¥¿éƒ¨ä¸ºç°è‰²æœªå¼€å‘åŒºåŸŸï¼Œä¸œéƒ¨ä¸ºé•¿æ²™éƒ¡ç®¡è¾–çš„å¤å¿ã€‚",
            groups: [
                { color: "#8c8c8c", members: ["æ–°åŒ–å¿", "å†·æ°´æ±Ÿå¸‚"] }, 
                { color: "#d4b16e", members: ["åŒå³°å¿", "å¨„æ˜ŸåŒº", "æ¶Ÿæºå¸‚"] }
            ],
            center: [27.70, 111.80], zoom: 9
        },
        {
            year: "å®‹ä»£ (1072)",
            title: "å¼€æ¢…å±± Â· ç½®æ–°åŒ–",
            desc: "å®‹ç¥å®—ç†™å®äº”å¹´ï¼Œç« æƒ‡å¼€æ¢…å±±ï¼Œç½®<b>æ–°åŒ–å¿</b>ã€‚å½“æ—¶çš„æ–°åŒ–å¿å¹…å‘˜è¾½é˜”ï¼ŒåŒ…å«äº†ä»Šå¤©çš„å†·æ°´æ±Ÿå¸‚å…¨å¢ƒã€‚ä¸œéƒ¨åœ°åŒºåˆ™ä¸»è¦å±<b>æ¹˜ä¹¡å¿</b>ï¼ˆéš¶å±é•¿æ²™åºœï¼‰ã€‚<br>ğŸ—ºï¸ <b>åœ°å›¾ï¼š</b>ç´«è‰²åŒºåŸŸä¸ºå¤æ–°åŒ–å¿ï¼Œè“è‰²åŒºåŸŸä¸ºå¤æ¹˜ä¹¡å¿ã€‚",
            groups: [
                { color: "#722ed1", members: ["æ–°åŒ–å¿", "å†·æ°´æ±Ÿå¸‚"] },
                { color: "#1890ff", members: ["åŒå³°å¿", "å¨„æ˜ŸåŒº", "æ¶Ÿæºå¸‚"] }
            ],
            center: [27.726, 111.326], zoom: 9
        },
        {
            year: "æ¸… (1644)",
            title: "æ¹˜å†›æ•…é‡Œ Â· æ›¾å›½è—©",
            desc: "æ¸…ä»£æ ¼å±€å»¶ç»­äº†å®‹æ˜ä½“åˆ¶ã€‚ä¸œéƒ¨<b>æ¹˜ä¹¡å¿</b>æ–‡æ•™æ˜Œç››ï¼Œèµ°å‡ºäº†ä»¥æ›¾å›½è—©ä¸ºé¦–çš„æ¹˜å†›é›†å›¢ã€‚è¥¿éƒ¨<b>æ–°åŒ–å¿</b>éš¶å±å®åº†åºœï¼ˆé‚µé˜³ï¼‰ï¼Œæ°‘é£å½ªæ‚ã€‚<br>ğŸ—ºï¸ <b>åœ°å›¾ï¼š</b>åŒå³°ç­‰ä¸œéƒ¨ä¸‰å¿å¸‚ä»ä¸ºä¸€ä½“ï¼ˆæ¹˜ä¹¡ï¼‰ï¼Œè¥¿éƒ¨ä¸ºæ–°åŒ–ã€‚",
            groups: [
                { color: "#722ed1", members: ["æ–°åŒ–å¿", "å†·æ°´æ±Ÿå¸‚"] },
                { color: "#1890ff", members: ["åŒå³°å¿", "å¨„æ˜ŸåŒº", "æ¶Ÿæºå¸‚"] }
            ],
            center: [27.422, 112.449], zoom: 9
        },
        {
            year: "1969å¹´",
            title: "ä¸–ç•Œé”‘éƒ½ Â· è®¾å¸‚",
            desc: "1969å¹´ï¼Œå› <b>é”¡çŸ¿å±±</b>å·¥çŸ¿ä¸šå‘å±•çš„æˆ˜ç•¥éœ€è¦ï¼Œå›½åŠ¡é™¢æ‰¹å‡†ä»æ–°åŒ–å¿æå‡º<b>å†·æ°´æ±Ÿå¸‚</b>ï¼ˆå¿çº§ï¼‰ã€‚<br>ğŸ—ºï¸ <b>åœ°å›¾ï¼š</b>æ©™è‰²åŒºåŸŸï¼ˆå†·æ°´æ±Ÿï¼‰ä»ç´«è‰²åŒºåŸŸä¸­ç‹¬ç«‹å‡ºæ¥ï¼Œæ ‡å¿—ç€å·¥çŸ¿åŸå¸‚çš„è¯ç”Ÿã€‚",
            groups: [
                { color: "#722ed1", members: ["æ–°åŒ–å¿"] },
                { color: "#fa8c16", members: ["å†·æ°´æ±Ÿå¸‚"] },
                { color: "#1890ff", members: ["åŒå³°å¿", "å¨„æ˜ŸåŒº", "æ¶Ÿæºå¸‚"] }
            ],
            center: [27.689, 111.433], zoom: 10
        },
        {
            year: "1977å¹´",
            title: "æ¶Ÿæºåœ°åŒº Â· ç»Ÿä¸€",
            desc: "1977å¹´ï¼Œå›½åŠ¡é™¢æ‰¹å‡†è®¾ç«‹<b>æ¶Ÿæºåœ°åŒº</b>ï¼Œè¡Œç½²é©»åœ°åœ¨å¨„åº•é•‡ï¼ˆä»Šå¨„æ˜ŸåŒºï¼‰ã€‚è¿™æ˜¯â€œå¨„åº•â€ä½œä¸ºä¸€ä¸ªç‹¬ç«‹åœ°çº§è¡Œæ”¿å•å…ƒçš„é›å½¢ã€‚<br>ğŸ—ºï¸ <b>åœ°å›¾ï¼š</b>äº”å¿å¸‚é¦–æ¬¡è¡Œæ”¿ç»Ÿä¸€ï¼Œæ˜¾ç¤ºä¸ºç»¿è‰²ã€‚",
            groups: [
                { color: "#27ae60", members: ["æ–°åŒ–å¿", "å†·æ°´æ±Ÿå¸‚", "åŒå³°å¿", "å¨„æ˜ŸåŒº", "æ¶Ÿæºå¸‚"] }
            ],
            center: [27.70, 111.99], zoom: 9
        },
        {
            year: "1999å¹´-ä»Š",
            title: "ç°ä»£ Â· å¨„åº•å¸‚",
            desc: "1999å¹´ï¼Œå¨„åº•æ’¤åœ°è®¾å¸‚ï¼ŒåŸå¿çº§å¨„åº•å¸‚æ”¹è®¾ä¸º<b>å¨„æ˜ŸåŒº</b>ã€‚å½¢æˆäº†ç°åœ¨çš„â€œä¸€åŒºä¸¤å¸‚ä¸¤å¿â€æ ¼å±€ã€‚<br>ğŸ—ºï¸ <b>åœ°å›¾ï¼š</b>äº”å½©æ–‘æ–“çš„ç°ä»£è¡Œæ”¿åŒºåˆ’ã€‚",
            groups: [
                { color: "#722ed1", members: ["æ–°åŒ–å¿"] },
                { color: "#fa8c16", members: ["å†·æ°´æ±Ÿå¸‚"] },
                { color: "#10b981", members: ["æ¶Ÿæºå¸‚"] },
                { color: "#3b82f6", members: ["åŒå³°å¿"] },
                { color: "#ef4444", members: ["å¨„æ˜ŸåŒº"] }
            ],
            center: [27.729, 112.008], zoom: 9
        }
    ];

    // ===========================================
    // 4. æ ¸å¿ƒé€»è¾‘ (âœ… å·²ä¿®æ­£å‡½æ•°ååŒ¹é…)
    // ===========================================
    const layers = { spots: L.layerGroup().addTo(map), borders: L.layerGroup().addTo(map) };
    let geoData = null;

    // å°è¯•è¯»å–æœ¬åœ° loudi.json
    fetch('loudi.json')
        .then(r => r.json())
        .then(d => {
            geoData = d;
            setMode('tour');
        })
        .catch(e => {
            console.error("åŠ è½½ loudi.json å¤±è´¥", e);
            alert("âš ï¸ æ— æ³•åŠ è½½ 'loudi.json' æ–‡ä»¶ï¼\n\nè¯·ç¡®ä¿ï¼š\n1. loudi.json å·²ä¸Šä¼ åˆ° GitHub ä»“åº“ï¼ˆæˆ–ä¸ html åœ¨åŒä¸€ç›®å½•ï¼‰ã€‚\n2. æ–‡ä»¶åå…¨å°å†™ã€‚\n3. å¦‚æœæ˜¯æœ¬åœ°é¢„è§ˆï¼Œè¯·ä½¿ç”¨ VS Code Live Serverï¼Œæµè§ˆå™¨ç›´æ¥æ‰“å¼€ file:// æ— æ³•è¯»å–æœ¬åœ°æ–‡ä»¶ã€‚");
        });

    window.setMode = function(mode) {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
        
        if(mode === 'tour') {
            document.querySelector('.tab:nth-child(1)').classList.add('active');
            document.getElementById('view-tour').classList.add('active');
            document.getElementById('timeline').classList.remove('show');
            renderTour();
        } else {
            document.querySelector('.tab:nth-child(2)').classList.add('active');
            document.getElementById('view-hist').classList.add('active');
            document.getElementById('timeline').classList.add('show');
            loadHist(5);
        }
    }

    function renderTour(filter = 'all', btn) {
        if(btn) {
            document.querySelectorAll('.tag-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
        }

        layers.spots.clearLayers();
        layers.borders.clearLayers();
        document.getElementById('spotList').innerHTML = '';

        if(geoData) {
            L.geoJSON(geoData, {
                style: f => {
                    const n = f.properties.name;
                    let c = "#999";
                    if(n.includes("æ–°åŒ–")) c="#8b5cf6";
                    else if(n.includes("å†·æ°´æ±Ÿ")) c="#f97316";
                    else if(n.includes("æ¶Ÿæº")) c="#10b981";
                    else if(n.includes("åŒå³°")) c="#3b82f6";
                    else if(n.includes("å¨„æ˜Ÿ")) c="#ef4444";
                    return { color: c, weight: 1, fillColor: c, fillOpacity: 0.1 };
                }
            }).addTo(layers.borders);
        }

        spots.forEach(s => {
            // ç­›é€‰é€»è¾‘
            if(filter === 'é«˜æ ¡' && (!s.tags || !s.tags.includes('é«˜æ ¡'))) return;
            if(filter === 'å­¦åºœ' && (!s.tags || !s.tags.includes('å­¦åºœ'))) return;
            if(filter !== 'all' && filter !== 'é«˜æ ¡' && filter !== 'å­¦åºœ' && s.area.indexOf(filter) === -1) return;

            let c = "#666";
            if(s.area.includes("æ–°åŒ–")) c="#8b5cf6";
            if(s.area.includes("åŒå³°")) c="#3b82f6";
            if(s.area.includes("å†·æ°´æ±Ÿ")) c="#f97316";
            if(s.area.includes("æ¶Ÿæº")) c="#10b981";
            if(s.area.includes("å¨„æ˜Ÿ")) c="#ef4444";
            
            // åˆ—è¡¨
            const card = document.createElement('div');
            card.className = 'spot-card';
            card.setAttribute('data-area', s.area);
            
            card.innerHTML = `
                <div class="card-icon" style="color:${c}">${s.icon}</div>
                <div class="card-info">
                    <div class="card-title">
                        <span>${s.name}</span>
                        <span class="card-area" style="color:${c}">${s.area}</span>
                    </div>
                    <div class="card-desc">${s.desc}</div>
                </div>`;
            
            // åˆ—è¡¨ç‚¹å‡»äº‹ä»¶
            card.onclick = () => {
                map.flyTo([s.lat, s.lng], 15);
                m.openPopup();
            };
            document.getElementById('spotList').appendChild(card);

            // æ ‡è®°
            const m = L.marker([s.lat, s.lng], { draggable: false }).addTo(layers.spots);
            
            m.bindPopup(`
                <div class="pop-head" style="background:${c}">${s.name}</div>
                <div class="pop-body">${s.desc}<a href="https://uri.amap.com/marker?position=${s.lng},${s.lat}&name=${s.name}" target="_blank" class="pop-link" style="background:${c}">ğŸš€ å¯¼èˆªå»è¿™é‡Œ</a></div>
            `);
        });
        
        if(filter === 'all' || filter === 'é«˜æ ¡' || filter === 'å­¦åºœ') map.setView([27.7017, 111.9963], 9);
    }
    
    window.filterSpots = renderTour;

    // âœ… ä¿®å¤åçš„ loadHist å‡½æ•°
    window.loadHist = function(idx) {
        document.querySelectorAll('.t-btn').forEach((b, i) => b.classList.toggle('active', i===idx));
        const d = historyEras[idx];
        document.getElementById('h-title').innerText = d.title;
        document.getElementById('h-era').innerText = d.year;
        document.getElementById('h-desc').innerHTML = d.desc;

        layers.spots.clearLayers();
        layers.borders.clearLayers();

        if(geoData) {
            L.geoJSON(geoData, {
                style: f => {
                    const n = f.properties.name;
                    // ä¿®æ­£ç‚¹ï¼šå°† x.m æ”¹ä¸º x.membersï¼Œå°† g.c æ”¹ä¸º g.color
                    let g = d.groups.find(x => x.members.some(k => n.includes(k)));
                    if(g) return { color: g.color, weight: 1, fillColor: g.color, fillOpacity: 0.6 };
                    return { opacity: 0, fillOpacity: 0 };
                }
            }).addTo(layers.borders);
            map.flyTo(d.center, d.zoom);
        }
    }
</script>

</body>
</html>